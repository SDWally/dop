# 闭包

- from https://haicoder.net/python/python-closure.html

## 概念 

- 闭包就是一个 函数 和与其相关的引用环境组合的一个整体。
- 将组成函数的语句和这些语句的执行环境打包在一起时，得到的对象称为闭包。

- 在 Python 中，闭包也被称为闭包函数或者闭合函数。
- 与 局部函数 类似，不同之处在于，闭包中外部函数返回的不是一个具体的值，而是一个函数。
- 一般情况下，返回的函数会赋值给一个 变量，这个变量可以在后面被继续执行调用。

## 闭包记忆效应

- 在 Python 中，被捕获到闭包中的变量让闭包本身拥有了记忆效应，
- 闭包中的逻辑可以修改闭包捕获的变量，变量会跟随闭包生命期一直存在，闭包本身就如同变量一样拥有了记忆功能。

```
print("嗨客网(www.haicoder.net)")
def add_upper():
    n = 20
    def add(x):
        nonlocal n
        n = n + x
        return n
    return add
# Python 闭包记忆效应，实现累加
f = add_upper()
print("闭包返回：", f(1))
print("闭包返回：", f(2))
print("闭包返回：", f(3))
```

## 底层

- 所有函数都有一个指向定义该函数的全局命名空间的 __globals__属性，
- 使用嵌套函数时，闭包将捕获内部函数执行所需的 整个环境
- func.__closure__ 属性
- func.__closure[0].cell_contents 属性 
- 应用场景： 在一系列函数调用中保持某个状态
