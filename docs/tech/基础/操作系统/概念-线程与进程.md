# 线程与进程

## 线程

线程（thread）是操作系统能够进行运算调度的最小单位，它被包含在进程之中，是进程中的实际运作单位。

## 

- 线程是独立调度和分派的基本单位。
- 线程可以为操作系统内核调度的内核线程，如Win32线程；由用户进程自行调度的用户线程，如Linux平台的POSIX Thread；或者由内核与用户进程，如Windows 7的线程，进行混合调度。
- 同一进程中的多条线程将共享该进程中的全部系统资源，如虚拟地址空间，文件描述符和信号处理等等。
- 但同一进程中的多个线程有各自的调用栈（call stack），自己的寄存器环境（register context），自己的线程本地存储（thread-local storage）。

## 本质

- 线程运行的本质其实就是函数的执行
- CPU 从入口函数开始执行从而形成一个执行流，即线程
- 函数运行时的信息保存在栈帧中
- 栈帧中保存了函数的返回值、调用其它函数的参数、该函数使用的局部变量以及该函数使用的寄存器信息
- 每个线程都有自己独立的、私有的栈区。

## 线程私有资源

所属线程的

- 栈区
- 程序计数器
- 栈指针
- 以及函数运行使用的寄存器是线程私有的。即，线程上下文，thread context。

###　线程与进程共享资源

- 代码区：编译后的可执行机器指令
- 数据区：存放的就是所谓的全局变量
- 堆区：线程共享的属于进程的资源，类对象等
- 动态链接库: 进程中的所有线程都可以使用动态链接库中的代码。
- 文件： 进程打开的文件也可以被所有的线程使用

### 线程同步

- 通过锁实现

### 多线程资源共享


## 进程

进程是资源分配的基本单位。所有与该进程有关的资源，都被记录在进程控制块PCB中。以表示该进程拥有这些资源或正在使用它们。
进程也是抢占处理机的调度单位，它拥有一个完整的虚拟地址空间。当进程发生调度时，不同的进程拥有不同的虚拟地址空间，而同一进程内的不同线程共享同一地址空间。

## 区别

- 进程是操作系统分配资源的单位，线程是程序调度的基本单位，线程之间共享进程资源

1）地址空间和其它资源（如打开文件）：进程间相互独立，同一进程的各线程间共享。某进程内的线程在其它进程不可见。
2）通信：进程间通信IPC，线程间可以直接读写进程数据段（如全局变量）来进行通信——需要进程同步和互斥手段的辅助，以保证数据的一致性。
3）调度和切换：线程上下文切换比进程上下文切换要快得多。
4）在多线程OS中，进程不是一个可执行的实体。
